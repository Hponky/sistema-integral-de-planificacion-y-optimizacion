<div class="controls-container">
  <!-- Header con t√≠tulo -->
  <div class="controls-header">
    <h3 class="controls-title">‚öôÔ∏è Configuraci√≥n de Generaci√≥n</h3>
  </div>

  <!-- Contenido principal organizado en secciones -->
  <div class="controls-content">

    <!-- Secci√≥n 1: Archivo de Personal -->
    <section class="control-section">
      <div class="section-label">
        <span class="label-icon">üìÅ</span>
        <span class="label-text">ARCHIVO DE PERSONAL</span>
      </div>

      <div class="file-upload-area" [class.has-file]="selectedFile" (click)="fileInput.click()">
        <input #fileInput type="file" (change)="onFileSelected($event)" accept=".xlsx,.xls" class="file-input-hidden">

        @if (!selectedFile) {
        <div class="upload-placeholder">
          <div class="upload-icon">üì§</div>
          <div class="upload-text">
            <span class="upload-title">Cargar Personal (Plantilla)</span>
            <span class="upload-subtitle">Datos de contrato y ventanas</span>
          </div>
        </div>
        } @else {
        <div class="file-selected">
          <div class="file-icon">‚úÖ</div>
          <div class="file-info">
            <span class="file-name">{{ selectedFile.name }}</span>
            <span class="file-size">{{ formatFileSize(selectedFile.size) }}</span>
          </div>
          <button class="file-remove" (click)="removeFile($event)">‚úñ</button>
        </div>
        }
      </div>
    </section>

    <!-- Secci√≥n 2: Archivo de Absentismos -->
    <section class="control-section" [class.unnecessary]="fictitiousAgents().length > 0">
      <div class="section-label">
        <span class="label-icon">üè•</span>
        <span class="label-text">ARCHIVO DE NOVEDADES / ABSENTISMOS</span>
        @if (fictitiousAgents().length > 0) {
        <span class="optional-tag">(No necesario)</span>
        }
      </div>

      <div class="file-upload-area" [class.has-file]="selectedAbsencesFile" (click)="absInput.click()">
        <input #absInput type="file" (change)="onAbsencesFileSelected($event)" accept=".xlsx,.xls"
          class="file-input-hidden">

        @if (!selectedAbsencesFile) {
        <div class="upload-placeholder">
          <div class="upload-icon">üì§</div>
          <div class="upload-text">
            <span class="upload-title">Cargar Absentismos (Opcional)</span>
            <span class="upload-subtitle">Vacaciones, Bajas, etc.</span>
          </div>
        </div>
        } @else {
        <div class="file-selected">
          <div class="file-icon">‚úÖ</div>
          <div class="file-info">
            <span class="file-name">{{ selectedAbsencesFile.name }}</span>
            <span class="file-size">{{ formatFileSize(selectedAbsencesFile.size) }}</span>
          </div>
          <button class="file-remove" (click)="removeAbsencesFile($event)">‚úñ</button>
        </div>
        }
      </div>
    </section>

    <!-- Secci√≥n 2: Rango de Fechas -->
    <section class="control-section">
      <div class="section-label">
        <span class="label-icon">üìÖ</span>
        <span class="label-text">RANGO DE FECHAS</span>
      </div>

      <div class="dates-grid">
        <div class="date-field">
          <label class="field-label">Fecha Inicio</label>
          <input type="date" [(ngModel)]="startDateStr" class="control-input" placeholder="Selecciona fecha">
        </div>

        <div class="date-field">
          <label class="field-label">Fecha Fin</label>
          <input type="date" [(ngModel)]="endDateStr" class="control-input" placeholder="Selecciona fecha">
        </div>
      </div>
    </section>

    <!-- Secci√≥n 3: Acciones -->
    <section class="control-section actions-section">
      <div class="actions-grid">
        <!-- Bot√≥n de configuraci√≥n -->
        <button class="settings-btn" (click)="openRules()" title="Configurar reglas">
          <span class="btn-icon">‚öôÔ∏è</span>
          <span class="btn-text">Configurar Reglas</span>
        </button>

        <!-- Bot√≥n de generar -->
        <button class="generate-btn" [class.loading]="loading()"
          [disabled]="loading() || (!selectedFile && fictitiousAgents().length === 0) || !selectedScenarioId"
          [title]="!selectedScenarioId ? 'Seleccione un escenario de dimensionamiento' : ((!selectedFile && fictitiousAgents().length === 0) ? 'Cargue personal o inyecte agentes' : 'Generar horario')"
          (click)="generate()">
          @if (!loading()) {
          <span class="btn-icon">‚ö°</span>
          <span class="btn-text">Generar Horarios</span>
          } @else {
          <span class="btn-icon spinning">‚è≥</span>
          <span class="btn-text">Generando...</span>
          }
        </button>

        @if (fictitiousAgents().length > 0) {
        <div class="sim-mode-badge" title="Agentes inyectados detectados">
          üß™ {{ fictitiousAgents().length }} simulados
        </div>
        }
      </div>
    </section>

    <!-- Bot√≥n de descarga (si existe) -->
    @if (downloadUrl()) {
    <section class="control-section download-section">
      <a href="#" (click)="onDownloadReport($event)" class="download-btn">
        <span class="download-icon">üì•</span>
        <span class="download-text">Descargar Reporte Generado</span>
        <svg class="download-arrow" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M7 4L13 10L7 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </a>
    </section>
    }
  </div>

  <!-- Modal de configuraci√≥n de reglas -->
  @if (showRulesModal()) {
  <app-rules-configuration (save)="onRulesSaved($event)" (close)="closeRules()"></app-rules-configuration>
  }
</div>